#!/bin/sh
#*=====================================================================*/
#*    serrano/prgm/project/bigloo/autoconf/maemo.arm                   */
#*    -------------------------------------------------------------    */
#*    Author      :  Manuel Serrano                                    */
#*    Creation    :  Wed Aug  9 13:27:23 1995                          */
#*    Last change :  Sat Jan 26 05:35:02 2008 (serrano)                */
#*    -------------------------------------------------------------    */
#*    Detect if we are running under maemo for ARM (QEMU)              */
#*=====================================================================*/

#*---------------------------------------------------------------------*/
#*    flags                                                            */
#*---------------------------------------------------------------------*/
cc=gcc
cflags=
tmp=/tmp
user=bigloo

#*---------------------------------------------------------------------*/
#*    We parse the arguments                                           */
#*---------------------------------------------------------------------*/
while : ; do
  case $1 in
    "")
      break;;

    --user=*)
      user="`echo $1 | sed 's/^[-a-z]*=//'`";;

    --cc=*|-cc=*)
      cc="`echo $1 | sed 's/^[-a-z]*=//'`";;

    --cflags=*|-cflags=*)
      cflags="`echo $1 | sed 's/^[-a-z]*=//'`";;

    --tmp=*|-tmp=*)
      tmp="`echo $1 | sed 's/^[-a-z]*=//'`";;

    -*)
      echo "Unknown option \"$1\", ignored" >&2;;
  esac
  shift
done

#*---------------------------------------------------------------------*/
#*    Test                                                             */
#*    -------------------------------------------------------------    */
#*    We assume that we are under maemo (QEMU) if the arch is an       */
#*    ARM but /proc/cpuinfo does not show any trace of an ARM          */
#*    processor.                                                       */
#*---------------------------------------------------------------------*/
mach=`uname -m`

if [ "$mach " = "arm " ]; then
  grep -i arm /proc/cpuinfo;
  exit $?
else
  exit 0
fi

#* file=$tmp/actest$user                                               */
#* aout=$tmp/Xactest$user                                              */
#*                                                                     */
#* {*---------------------------------------------------------------------*} */
#* {*    compile                                                          *} */
#* {*---------------------------------------------------------------------*} */
#* compile="$cc $cflags $file.c -o $aout >/dev/null 2> /dev/null"      */
#*                                                                     */
#* {*---------------------------------------------------------------------*} */
#* {*    The test C file                                                  *} */
#* {*---------------------------------------------------------------------*} */
#* if( test -f $file.c ); then                                         */
#*    rm -f $file.c || exit $?                                         */
#* fi                                                                  */
#*                                                                     */
#*---------------------------------------------------------------------*/
#*    Test                                                             */
#*---------------------------------------------------------------------*/
#* cat > $file.c <<EOF                                                 */
#* #include <stdlib.h>                                                 */
#* #include <string.h>                                                 */
#*                                                                     */
#* int main( int argc, char *argv[], char *env[] ) {                   */
#*    char *s = getenv( "SBOX_CPU" );                                  */
#*                                                                     */
#*    if( s && !strcmp( s, "arm" ) ) {                                 */
#*       return 1;                                                     */
#*    } else {                                                         */
#*       return 0;                                                     */
#*    }                                                                */
#* }                                                                   */
#* EOF                                                                 */
#*                                                                     */
#* {*---------------------------------------------------------------------*} */
#* {*    Compilation test                                                 *} */
#* {*---------------------------------------------------------------------*} */
#* if eval $compile; then                                              */
#*    $aout                                                            */
#*    res=$?                                                           */
#*    \rm -f $file.*                                                   */
#*    rm -f $aout                                                      */
#*    rm -f $aout*                                                     */
#*    exit $res                                                        */
#* else                                                                */
#*    \rm -f $file.*                                                   */
#*    exit 0                                                           */
#* fi                                                                  */

