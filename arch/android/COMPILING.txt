NOTE: in this document we use the following definitions for cross compiling[1]:

 * host: platform where everything will be compiled. usually
   i386/i686/amd64/x86_64+Linux or Mac.
 * target: platform which will run the resulting binary. arm+Android in this
   case.

Getting stuff:
=============

Compiling Bigloo for Android requires several things:

 (Install all this as a subdirectory of the same directory. This will make
 configuration simpler).

 * Android SDK[2].
 * Download droid-wrapper[4]. The command is:
   'git clone git://github.com/tmurakam/droid-wrapper.git'. Then apply
   droid-wrapper.diff shipped in this directory and install.
 * Get Android Eclair's source code, for which you'll need git. See instructions
   below.

Also you will require:

 * An already compiled and running bigloo version for the host platform.


Android Code:
============

These instructions are based on [3].

First, you might need to introduce yourself to git:

   git config --global user.email "you@example.com"
   git config --global user.name "Your Name"

Download repo, a wrapper around git:

   curl http://android.git.kernel.org/repo > ~/bin/repo
   chmod a+x ~/bin/repo

Get Eclair's definitions and source code:

   mkdir eclair-git
   cd eclair-git
   repo init -u git://android.git.kernel.org/platform/manifest.git -b eclair
   repo sync

// MS, Sep 20: Is it needed to *COMPILE* eclair? I presume it is otherwise
   droid-gcc fails to find files such as 
     eclair-git/out/target/product/generic/obj/lib/crtbegin_dynamic.o:
   hence I have compiled eclair with a plain "make" in the git eclair-dir


Configuring:
===========

Copy 'arch/android/config-local.sh.sample' into 'arch/android/config-local.sh'
and edit it. Point ANDROIDROOT to the directory where you downloaded and
decompressed all the Android tools, and BS_BIGLOO to the dir where the host
bigloo resides.

// MS, Sep 20: what are the Android tools, the tools that come with the SDK?
// MS, Sep 20: This is unclear what you mean by BS_BIGLOO to the dir where
   the host bigloo resides. Do you mean the source code or do you mean the
   Bigloo installation directory?


Compiling:
=========

You will need an Android 2.0 (eclair) or newer device running. This can be a
real phone with USB debugging turned on (you can turn it on when you plug in
the USB cable; we at least know Motorola Droid/Milestone and HTC Desire can do
it) or any device emulated in the SDK's emulator. You can test with SDK's
'tools/adb logcat' wether you can connect to the device. If you can't,
'killall adb'[5], fix whatever is wrong and try again.

Then you can simply run:

   ./arch/android/build-android.sh configure

// MS, Sep 20: but if this fails, there is no error message to help!

If everything's ok, then you can compile:

   ./arch/android/build-android.sh build

If everything's ok, then you can install[6]:

   make install


Notes:
=====

The current version assumes you're using Android SDK r07, which decompresses in
a directory called 'android-sdk-linux_x86'. If you're using another version and
the path changes (in r04 it was 'android-sdk-linux' and in r06 it was
'android-sdk-linux_86') , edit 'arch/android/config.sh' to reflect the change,
and please let us know.

--
[1] http://en.wikipedia.org/wiki/Cross_compile#GCC_and_cross_compilation

[2] http://developer.android.com/sdk/index.html

[3] http://source.android.com/source/download.html

[4] http://github.com/tmurakam/droid-wrapper

[5] 'adb' runs as a daemon and somehow is not affected by e.g. permission
    changes.

[6] but currently it doesn't make much sense.
