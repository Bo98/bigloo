;*=====================================================================*/
;*    serrano/prgm/project/bigloo/api/libuv/src/Llib/os.scm            */
;*    -------------------------------------------------------------    */
;*    Author      :  Manuel Serrano                                    */
;*    Creation    :  Thu Jul 10 11:28:07 2014                          */
;*    Last change :  Wed Feb  4 17:55:30 2015 (serrano)                */
;*    Copyright   :  2014-15 Manuel Serrano                            */
;*    -------------------------------------------------------------    */
;*    LIBUV os                                                         */
;*=====================================================================*/

;*---------------------------------------------------------------------*/
;*    The module                                                       */
;*---------------------------------------------------------------------*/
(module __libuv_os
   
   (include "uv.sch")
   
   (import  __libuv_types)
   
   (export  (uv-loadavg ::f64vector)
	    (inline uv-get-free-memory::double)
	    (inline uv-get-total-memory::double)
	    (inline uv-get-resident-memory::long)
	    (inline uv-cpus::vector)
	    (uv-uptime::double)
	    (inline uv-exepath::bstring)))

;*---------------------------------------------------------------------*/
;*    uv-loadavg ...                                                   */
;*---------------------------------------------------------------------*/
(define (uv-loadavg buf)
   ($uv-loadavg ($f64vector->double* buf 0))
   buf)

;*---------------------------------------------------------------------*/
;*    uv-get-free-memory ...                                           */
;*---------------------------------------------------------------------*/
(define-inline (uv-get-free-memory)
   ($uv-get-free-memory))

;*---------------------------------------------------------------------*/
;*    uv-get-total-memory ...                                          */
;*---------------------------------------------------------------------*/
(define-inline (uv-get-total-memory)
   ($uv-get-total-memory))

;*---------------------------------------------------------------------*/
;*    uv-get-resident-memory ...                                       */
;*---------------------------------------------------------------------*/
(define-inline (uv-get-resident-memory)
   ($uv-resident-memory))

;*---------------------------------------------------------------------*/
;*    uv-cpus ...                                                      */
;*---------------------------------------------------------------------*/
(define-inline (uv-cpus)
   ($uv-cpus))

;*---------------------------------------------------------------------*/
;*    uv-uptime ...                                                    */
;*---------------------------------------------------------------------*/
(define (uv-uptime)
   (let ((uptime::double (pragma::double "0.0")))
      ($uv-uptime (&double uptime))
      uptime))

;*---------------------------------------------------------------------*/
;*    uv-exepath ...                                                   */
;*---------------------------------------------------------------------*/
(define-inline (uv-exepath)
   ($uv-exepath))
